<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hospital.registration.mapper.PaymentMapper">

    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.hospital.registration.entity.Payment">
        <id column="id" property="id"/>
        <result column="transaction_no" property="transactionNo"/>
        <result column="registration_id" property="registrationId"/>
        <result column="user_id" property="userId"/>
        <result column="amount" property="amount"/>
        <result column="payment_method" property="paymentMethod"/>
        <result column="payment_status" property="paymentStatus"/>
        <result column="payment_time" property="paymentTime"/>
        <result column="refund_time" property="refundTime"/>
        <result column="remark" property="remark"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="deleted" property="deleted"/>
    </resultMap>

    <!-- 根据挂号ID查询支付记录 -->
    <select id="selectByRegistrationId" resultMap="BaseResultMap">
        SELECT *
        FROM payment
        WHERE registration_id = #{registrationId}
          AND deleted = 0
        LIMIT 1
    </select>

    <!-- 根据交易流水号查询支付记录 -->
    <select id="selectByTransactionNo" resultMap="BaseResultMap">
        SELECT *
        FROM payment
        WHERE transaction_no = #{transactionNo}
          AND deleted = 0
        LIMIT 1
    </select>

    <!-- 查询用户的支付记录 -->
    <select id="selectByUserId" resultMap="BaseResultMap">
        SELECT *
        FROM payment
        WHERE user_id = #{userId}
          AND deleted = 0
        ORDER BY create_time DESC
    </select>

</mapper>
